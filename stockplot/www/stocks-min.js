/*
 * Ext JS Library 3.0.0
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 *
 * This application is developed by Jeroen Ooms (www.jeroenooms.com)
 */
function PlotConfig(d,a,b,c){this.market=d;this.company=a;this.graphType=b;this.timeFrame=c}PlotConfig.prototype.toJSON=function(){return Ext.util.JSON.encode(this)};PlotConfig.prototype.toString=function(){return Ext.util.JSON.encode(this)};Ext.onReady(function(){Ext.QuickTips.init();var k;var m=0;var p="S";var j=3;function f(t){if(t==1){return'<div class="start-div"><div style="float:left; margin: 0 0 0 0; padding 0 0 0 0;" ><img src="images/layout-icon.gif" /></div><div style="display: block; margin-left:100px;"> <h2>Workspace '+t+'</h2><div><p><b>Double click</b> a company from the menu to open a new window.</p>	<p>To compare graphs you can <b>Drag and Drop</b> a company into the workspace window.</p> <p> Once you have plotted a graph, <b>Right Mouseclick</b> on it to change or update it.</p><p>Press <b>F11</b> to use this application in Full Screen</p><div id="demovideo"><p>Click <a href="http://www.youtube.com/watch?v=ieEX1yTvHFU" target="_blank">Here</a> for a short Demo Video!</p></div></div></div></div>'}return'<div class="start-div"><div style="float:left; margin: 0 0 0 0; padding 0 0 0 0;" ><img src="images/layout-icon.gif" /></div><div style="display: block; margin-left:100px;"> <h2>Workspace '+t+"</h2></div></div>"}function g(){this.ownerCt.ownerCt.removeAll();switch(this.value){case 1:var t=Ext.getCmp(h.id).getActiveTab().graphWindows=new Array(1);t[0]=this.ownerCt.ownerCt.add({plotarea:true,flex:1,border:true,margins:"0 0 0 0",html:f(Ext.getCmp(h.id).getActiveTab().workspaceNumber)});break;case 2:var t=Ext.getCmp(h.id).getActiveTab().graphWindows=new Array(2);t[0]=this.ownerCt.ownerCt.add({plotarea:true,flex:1,border:true,margins:"0 0 0 0"});t[1]=this.ownerCt.ownerCt.add({plotarea:true,flex:1,border:true,margins:"2 0 0 0"});break;case 3:var t=Ext.getCmp(h.id).getActiveTab().graphWindows=new Array(2);t[0]=this.ownerCt.ownerCt.add({plotarea:true,flex:1,border:true,margins:"0 0 2 0"});var u=this.ownerCt.ownerCt.add({flex:1,border:false,margins:"0 0 0 0",layout:"hbox",layoutConfig:{align:"stretch"}});t[1]=u.add({plotarea:true,flex:1,border:true,margins:"0 2 0 0"});t[2]=u.add({plotarea:true,flex:1,border:true,margins:"0 0 0 0"});break;case 4:var t=Ext.getCmp(h.id).getActiveTab().graphWindows=new Array(2);subWindow1=this.ownerCt.ownerCt.add({flex:1,border:false,margins:"0 0 0 0",layout:"hbox",layoutConfig:{align:"stretch"}});t[0]=subWindow1.add({plotarea:true,flex:1,border:true,margins:"0 0 0 0"});t[1]=subWindow1.add({plotarea:true,flex:1,border:true,margins:"0 0 0 2"});subWindow2=this.ownerCt.ownerCt.add({flex:1,border:false,margins:"0 0 0 0",layout:"hbox",layoutConfig:{align:"stretch"}});t[2]=subWindow2.add({plotarea:true,flex:1,border:true,margins:"2 0 0 0"});t[3]=subWindow2.add({plotarea:true,flex:1,border:true,margins:"2 0 0 2"});break}this.ownerCt.ownerCt.doLayout();dropTargetElements=Ext.getCmp(h.id).getActiveTab().graphWindows;for(dropi=0;dropi<dropTargetElements.length;dropi++){dropTargetElements[dropi].getEl().first().first().set({counter:dropi});new Ext.dd.DropTarget(dropTargetElements[dropi].getEl().first().first(),{ddGroup:"DragDrop",overClass:"nodeOverDragzone",notifyDrop:e})}}function c(){var t=Ext.getCmp(h.id).getActiveTab().graphWindows;var u=new Object;for(i=0;i<t.length;i++){u["plot"+i]=t[i].plotConfig;if(t[i].plotConfig==undefined|t[i].plotConfig==""){u["plot"+i]="NA"}else{u["plot"+i]=t[i].plotConfig}}r("../brew/YHWSpdfplot","PDF",["plotRequest"],[Ext.util.JSON.encode(u)])}imageContext=function(v,u,w){if(Ext.getCmp(this.id)&&Ext.getCmp(this.id).isXType("window")){thisWindow=Ext.getCmp(this.id)}else{counter=this.getAttribute("counter");thisWindow=Ext.getCmp(h.id).getActiveTab().graphWindows[counter]}menu=new Ext.menu.Menu({items:['<b class="menu-title">'+thisWindow.plotConfig.company+"</b>",{text:"Graphtype",iconCls:"chartIcon",handler:function(){return false},menu:{listeners:{itemclick:function(t){thisWindow.plotConfig.graphType=t.value;s(thisWindow,thisWindow.plotConfig)}},items:[{text:"Smoothed Plot",value:"S",group:"menuGraphType",checked:(thisWindow.plotConfig.graphType=="S")},{text:"High/Low Plot",value:"H",group:"menuGraphType",checked:(thisWindow.plotConfig.graphType=="H")}]}},{text:"Timeframe",iconCls:"calendarIcon",handler:function(){return false},menu:{listeners:{itemclick:function(t){thisWindow.plotConfig.timeFrame=t.value;s(thisWindow,thisWindow.plotConfig)}},items:[{text:"1 Month",value:"1",group:"menuTimeFrame",checked:(thisWindow.plotConfig.timeFrame==1)},{text:"3 Months",value:"2",group:"menuTimeFrame",checked:(thisWindow.plotConfig.timeFrame==2)},{text:"6 Months",value:"3",group:"menuTimeFrame",checked:(thisWindow.plotConfig.timeFrame==3)},{text:"1 Year",value:"4",group:"menuTimeFrame",checked:(thisWindow.plotConfig.timeFrame==4)},{text:"5 Years",value:"5",group:"menuTimeFrame",checked:(thisWindow.plotConfig.timeFrame==5)}]}},"-",{text:"Refresh",iconCls:"refresh2",handler:function(){s(thisWindow,thisWindow.plotConfig)}},{text:"Get PDF",iconCls:"pdf16",handler:function(){a(thisWindow.plotConfig)}}]});menu.showAt(v.getPoint());v.stopEvent()};function s(v,w){if(!v.isXType("window")){winWidth=v.getSize().width;winHeight=v.getSize().height}else{winWidth=585;winHeight=450}var u=new Object();for(var t in w){u[t]=w[t]}u.height=winHeight;u.width=winWidth;v.load({url:"../brew/YHstocksplot",method:"POST",params:{plotRequest:Ext.util.JSON.encode(u)},timeout:99})}function e(v,w,u){var t=this.getEl().getAttribute("counter");if(u.node.leaf==true){market="AEX";company=u.node.id.substring(3);thisWindow=Ext.getCmp(h.id).getActiveTab().graphWindows[t];thisWindow.plotConfig=new PlotConfig(market,company,p,j);s(thisWindow,thisWindow.plotConfig);Ext.get(this.id).on("contextmenu",imageContext)}}function q(){m++;var t=h.add({workspaceNumber:m,iconCls:"tabs",closable:(m!=1),title:"Workspace "+m,layout:"vbox",layoutConfig:{align:"stretch"},tbar:[{text:"Add new Workspace",handler:q,iconCls:"new-tab"},"->",{xtype:"combo",editable:false,emptyText:"Split Workspace",triggerAction:"all",value:1,lazyRender:true,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[[1,"1 Graph"],[2,"2 Graphs"],[3,"3 Graphs"],[4,"4 Graphs"]]}),forceSelection:true,valueField:"myId",displayField:"displayText",listeners:{select:g}},"-",{text:"Clear Workspace",iconCls:"resetIcon",handler:function(){this.ownerCt.getComponent(2).fireEvent("select")}},"-",{text:"Export Workspace to PDF",iconCls:"pdf16",handler:function(){c()}}],border:true}).show();t.getTopToolbar().getComponent(2).fireEvent("select")}updateDetails=function(u){if(!k){var t=Ext.getCmp("details-panel").body;t.update("").setStyle("background","#fff");k=t.createChild()}if(u.isLeaf()){k.hide().update(Ext.getDom("company-details").innerHTML).slideIn("l",{stopFx:true,duration:0.2});document.getElementById("detailsHeader").innerHTML="";document.getElementById("detailsHeader").appendChild(document.createTextNode(u.text));document.getElementById("yahooLink").href="http://finance.yahoo.com/q?s="+u.id.substring(3);document.getElementById("wikiLink").href="http://www.google.com/search?hl=en&q=site:en.wikipedia.org+"+u.text+"+"+u.id.substring(3).split(".")[0]+"&btnI=I'm+Feeling+Lucky&aq=f&oq=&aqi="}};switchWorkspace=function(u,w){var t=Ext.getCmp(h.id).getActiveTab().graphWindows;if(w){q();Ext.getCmp(h.id).getActiveTab().getTopToolbar().getComponent(2).setValue(t.length);Ext.getCmp(h.id).getActiveTab().getTopToolbar().getComponent(2).fireEvent("select")}var v=Ext.getCmp(h.id).getActiveTab().graphWindows;for(i=0;i<v.length;i++){if((t[i].plotConfig.company==undefined)||(t[i].plotConfig.company=="")||(t[i].plotConfig.company=="NA")){}else{v[i].plotConfig=new PlotConfig("AEX",u.id.substring(3),t[i].plotConfig.graphType,t[i].plotConfig.timeFrame);s(v[i],v[i].plotConfig);v[i].getEl().first().first().on("contextmenu",imageContext)}}};contextMenu=function(t,u){if(t.isLeaf()){that=this;menu=new Ext.menu.Menu({items:[{text:"Switch workspace to <b> "+t.text+"</b>",iconCls:"switchWorkspaceIcon",handler:function(){switchWorkspace(t,false)}},{text:"Copy workspace for <b> "+t.text+"</b>",iconCls:"copyWorkspaceIcon",handler:function(){switchWorkspace(t,true)}}]});u.stopEvent();menu.showAt(u.getPoint())}else{u.stopEvent()}};var o=new Ext.tree.TreePanel({id:"tree-panel",iconCls:"downArrow",title:"by Index",height:300,autoScroll:true,lazyRender:true,animate:true,containerScroll:true,enableDrag:true,dragConfig:{ddGroup:"DragDrop"},autoWidth:true,rootVisible:false,lines:false,singleExpand:true,useArrows:true,dataUrl:"tree-data.php",root:new Ext.tree.AsyncTreeNode({id:"root1"})});var n=new Ext.tree.TreePanel({id:"tree-panel2",iconCls:"downArrow",title:"by Name",height:300,autoScroll:true,animate:true,containerScroll:true,enableDrag:true,dragConfig:{ddGroup:"DragDrop"},autoWidth:true,rootVisible:false,lines:false,singleExpand:true,useArrows:true,dataUrl:"tree-data2.php",root:new Ext.tree.AsyncTreeNode({id:"root2"})});o.on("click",updateDetails);n.on("click",updateDetails);o.on("contextmenu",contextMenu);n.on("contextmenu",contextMenu);o.on("dblclick",function(t){openStockWindow(t,t.parentNode.id,t.id.substring(3),this)});n.on("dblclick",function(t){openStockWindow(t,t.parentNode.id,t.id.substring(3),this)});openStockWindow=function(x,w,t,u){var v=u.selModel.selNode||{};if(x.leaf){thisWindow=new Ext.Window({layout:"fit",width:600,height:480,title:x.text,resizable:false,constrain:true,collapsible:true,pageX:Math.floor(250+Math.random()*150),pageY:Math.floor(20+Math.random()*150),renderTo:Ext.get("workspace-panel")});thisWindow.plotConfig=new PlotConfig(w,t,p,j);s(thisWindow,thisWindow.plotConfig);Ext.get(thisWindow.id).on("contextmenu",imageContext);thisWindow.show(this)}};function a(t){r("../brew/YHpdfplot","PDF",["plotRequest"],[t])}var l={id:"details-panel",title:"Details",titleCollapse:true,height:150,collapsible:true,region:"south",split:true,bodyStyle:"padding-bottom:15px;background:#eee;",autoScroll:true,html:'<p class="details-info">When you select a company from the menu, some details will display here.</p>'};var b=[{text:"Smoothed Plot",id:"graphTypeBtn",xtype:"splitbutton",iconCls:"chartIcon",menu:{listeners:{itemclick:function(t){p=t.value;Ext.getCmp("graphTypeBtn").setText(t.text)}},id:"currentGraphType",items:[{text:"Smoothed Plot",group:"graphType",checked:true,value:"S"},{text:"High/Low Plot",group:"graphType",checked:false,value:"H"}]}},"-",{text:"6 Months",id:"timeFrameBtn",xtype:"splitbutton",iconCls:"calendarIcon",menu:{listeners:{itemclick:function(t){j=t.value;Ext.getCmp("timeFrameBtn").setText(t.text)}},id:"currentTimeFrame",items:[{text:"1 Month",group:"timeFrame",checked:false,value:1},{text:"3 Months",group:"timeFrame",checked:false,value:2},{text:"6 Months",group:"timeFrame",checked:true,value:3},{text:"1 Year",group:"timeFrame",checked:false,value:4},{text:"5 Years",group:"timeFrame",checked:false,value:5}]}}];var d=new Ext.TabPanel({tbar:b,activeTab:0,id:"tab-panel",region:"center",height:300,border:false,tabPosition:"bottom",items:[o,n]});var h=new Ext.TabPanel({activeTab:0,id:"workspace-panel",region:"center",margins:"2 5 5 0",height:350,border:false,tabPosition:"bottom"});new Ext.Viewport({id:"viewport",layout:"border",title:"Ext Layout Browser",items:[{xtype:"box",region:"north",applyTo:"header",height:30},{layout:"border",id:"layout-browser",region:"west",border:false,border:true,split:true,margins:"2 0 5 5",width:250,minSize:100,maxSize:500,items:[d,l]},h],renderTo:Ext.getBody()});q();Ext.getCmp("viewport").doLayout();function r(v,u,y,t){var z=window.open("",u);if(!z){return false}var x="";x+="<html><head></head><body><form id='formid' method='post' action='"+v+"'>";if(y&&t&&(y.length==t.length)){for(var w=0;w<y.length;w++){x+="<input type='hidden' name='"+y[w]+"' value='"+t[w]+"'/>"}}x+="</form><script type='text/javascript'>document.getElementById(\"formid\").submit()<\/script></body></html>";z.document.write(x);return z}Ext.override(Ext.Element,{contains:function(t){return !t||(Ext.isGecko&&Object.prototype.toString.call(t)=="[object XULElement]")?false:Ext.lib.Dom.isAncestor(this.dom,t.dom?t.dom:t)}})});